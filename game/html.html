<html>
<head>
<title></title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" type="text/css" href="style.css" >

</head>
<body>

<canvas id="canvas" width="810" height="600"></canvas>
 <script src='js/jquery-3.5.1.min.js'></script>
<script src='js/level.js'></script>
<script src='js/js.js'></script>
    
 
<script language="JavaScript">

var can = document.getElementById("canvas");
var c = can.getContext('2d');
   
function mainLoop() {
    
    updategame();
    updatefon();
if(game.state=="playing")updatePlayer();	
    
    drawBackground();
    drowMapobj();
    drawPlayer();
    drowPortal();
    
    if(game.state=="load_map_1" || game.state=="load_map_2") drowblackmenu();  
}

    
// =========== player ============

function drawPlayer() {  

     c.beginPath();
     c.globalAlpha = 1;
     c.fillStyle = palitra_color.black.Name;
     c.strokeStyle= palitra_color.black.Name;
     c.arc(player.x+15, player.y+15, 15, 0, Math.PI*2, false);
     c.fill(); 
     c.closePath();
     c.stroke();
}
    
 
// =========== background ============

function drawBackground() {
     c.globalAlpha = 1;
     c.fillStyle = 'rgb('+fon.R+","+fon.G+","+fon.B+")";
     c.fillRect(0,0 , can.width, can.height);
}

function drowMapobj(){
    for(i in obj) {
        var Obj = obj[i];                       
        c.beginPath();
        c.globalAlpha = 1;
        c.fillStyle = Obj.color;
        c.strokeStyle= Obj.color;
        c.arc(Obj.x+15, Obj.y+15, 6+getRandomInt(2,5), 0, Math.PI*2, false);
        c.fill(); 
        c.closePath();
        c.stroke();            
  }
    
    for(i in block) {
        var Block = block[i];
        c.beginPath();
        c.globalAlpha = 1;
        c.fillStyle = Block.color;
        c.fillRect(Block.x,Block.y , game.mashtab, game.mashtab);
        c.closePath();
  }
    
}

function drowPortal(){
    c.globalAlpha = 1;
    c.moveTo (finis.x+15, finis.y+15);
    c.strokeStyle= palitra_color.black.Name;
    var increment = 2*Math.PI/360;       
    var theta = increment;
        finis.animaciacryg+=0.2;
        if(finis.animaciacryg>=6)
        finis.animaciacryg=0;
            while (theta < 5*2*Math.PI) {   
            var newX = finis.x+15 - theta * Math.cos(theta+ finis.animaciacryg); 
            var newY = finis.y+15 + theta * Math.sin(theta+ finis.animaciacryg); 
            c.lineTo (newX, newY);
            theta += increment;
            }
    c.stroke();

}    

function drowblackmenu(){

    if(game.state=="load_map_1")
        {
          fon.zatemnenie+=0.1
        }

     if(game.state=="load_map_2")
        { 
            fon.zatemnenie-=0.1
        }
    
     c.globalAlpha = fon.zatemnenie;
     c.fillStyle = palitra_color.black.Name;
     c.fillRect(0,0 , can.width, can.height);
      
} 
      
    
doSetup();
setInterval(mainLoop,60);
    
</script>
 
</body>
</html>
